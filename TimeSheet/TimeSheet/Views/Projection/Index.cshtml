@using System.Linq;
@*@model IEnumerable<TimeSheet.Models.ProjectDetailsModel>*@
@model TimeSheet.Models.ProjectionModel
@{
    ViewBag.Title = "Index";
}
<script src="https://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script>
<link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src=" https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/balloon-css/balloon.min.css">
@*<script src="~/Scripts/jquery-1.10.2.min.js"></script>*@

    <div class="container" style="width:170%; padding-top:15px; margin-left: 1px; border-color:lightgray">
        
            <div id="MANAGEPROJECTION" >
                <table class="table-bordered table-responsive-md text-center table-hover table-scroll" id="MANAGEPROJECTION" >
                    <thead style="background-color:#FFA500;color:white ">
                        <tr>

                            <th>ProjectName</th>
                            <th>Oppurtunity</th>
                            <th>PM</th>
                            <th>Services</th>
                            <th>Facility</th>
                            <th>AllocatedDate</th>
                            <th>Quantity</th>
                            <th>EstimatedInvoiceDate</th>
                            <th>Comments</th>
                            <th style="width:10px"></th>
                            <th class="hidden"></th>
                            <th class="hidden"></th>

                        </tr>
                    </thead>
                    <tbody class="table">
                        @foreach (var item in Model.projectionOpportunityModel)
                        {
                        <tr>
                            <td class="ProjectName">
                                <span id="txtProjectName"> @Html.DisplayFor(modelItem => item.ProjectName) </span>
                            </td>
                            <td class="opportunity">
                                <span id="txtOpportunityId">@Html.DisplayFor(modelItem => item.OpportunityNumber) </span>
                            </td>
                            <td class="PM">
                                <span id="txtPM">@Html.DisplayFor(modelItem => item.ProjectManager) </span>
                            </td>
                            <td data-balloon-length="xlarge" aria-label='@item.Activity' data-balloon-pos="up" >
                                <input type="text" id="txtActivityDesc" value='@item.Activity' disabled="disabled" />


                            </td>
                            <td>
                                @{var isEmptyFacility = string.IsNullOrEmpty(@item.wareHouseName);}
                                @if (isEmptyFacility)
                                {
                                    @Html.DropDownList("Warehouse", Model.WarehouseList, "Facility",new { id = "WarehouseID" })
                                }
                                else
                                {
                                    @Html.DropDownList("Warehouse", Model.WarehouseList, @item.wareHouseName,new { id = "WarehouseID" })
                                }
                            </td>
                            <td>
                                @if (item.DateInvoiced.HasValue)
                                {
                                    <span id="startTime">@item.DateInvoiced.Value.ToShortDateString()</span>
                                }
                                else
                                {
                                    <span id="startTime">@DateTime.Now.ToShortDateString()</span>
                                }
                                <input type="date" id="startTime" value="@item.DateInvoiced" style="display:none" />
                            </td>
                            <td>

                                <span>@Html.DisplayFor(modelItem => item.ActualQuantity)</span>
                                <input type="text" id="quantity" value="@item.ActualQuantity" style="display:none" />
                            </td>
                            <td>
                                @if (item.DateModified.HasValue)
                                {
                                    <span id="endTime">@item.DateModified.Value.ToShortDateString()</span>
                                }
                                else
                                {
                                    <span id="startTime">@DateTime.Now.ToShortDateString()</span>
                                }
                                <input type="date" id="endTime" value="@item.DateModified" style="display:none" />
                            </td>
                            <td class="commentsLine">
                                <span id="comments">@item.Comments</span>
                                <input type="text" id="comments" value="@item.Comments" style="display:none" />
                            </td>
                            <td>
                                <a class="Edit" href="javascript:;">Edit</a>
                                <a class="Update" href="javascript:;" style="display:none" id="Update">Update</a>
                                <a class="Cancel" href="javascript:;" style="display:none">Cancel</a>
                                @*<a class="Delete" href="javascript:;">Delete</a>*@
                            </td>
                            <td class="hidden"><input type="text" id="txtServiceActvty" value="@item.ServiceActivityId" /></td>
                            <td class="hidden"><input type="text" id="txtActvty" value="@item.ActivityId" /></td>
                        </tr>
                        }
                    </tbody>
                </table>

            </div>


    </div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")"></script>
    <script type="text/javascript">
    </script>
}
<script language="javascript" type="text/javascript">

    $(document).ready(function () {
          $('table#MANAGEPROJECTION').DataTable();
       
    });



          

    //Edit event handler.
    $("body").on("click", "#MANAGEPROJECTION .Edit", function () {
        var row = $(this).closest("tr");
        $("td", row).each(function () {
            if ($(this).find("input").length > 0) {
                $(this).find("input").show();
                $(this).find("span").hide();
                 $(this).toggleClass('selected');
            }
        });
        row.find(".Update").show();
        row.find(".Cancel").show();

        $(this).hide();
    });

    //Update event handler.
    $("body").on("click", "#MANAGEPROJECTION .Update", function () {
        var row = $(this).closest("tr");
        $("td", row).each(function () {
            if ($(this).find("input").length > 0) {
                var span = $(this).find("span");
                var input = $(this).find("input");
                span.html(input.val());
                span.show();
                input.hide();
               $(this).removeClass('selected');
            }
        });
        row.find(".Edit").show();
     

        row.find(".Cancel").hide();
        $(this).hide();
        
        var ProjectionModel = {};
        var loadUrl = '@Url.Action("UpdateProjectionModel", "Projection")';
    
        var model = {
                    'OpportunityId' :row.find("span#txtOpportunityId").text(),
                    'Quantity' : row.find("input#quantity").val(),
                    'DateInvoiced' : row.find("input#startTime").val(),
                    'DateModified': row.find("input#endTime").val(),
                    'WarehouseID': row.find("select#WarehouseID").val(),
                    'ServiceActivityId': row.find("#txtServiceActvty").val(),
                    'ActivityId': row.find("#txtActvty").val(),
                    'Comments': row.find("input#comments").val()
                    
                };                      
        $.ajax({
            data: model,
            url: '@Url.Action("UpdateProjectionModel", "Projection")',
            type: "POST",
            success:function(data) {
                if (data.status === 'OK') {
                    window.location.href = data.Url
                }
                else {
                    alert("The status cannot be updated at this time");
                }
            }
        });
    });
    //Cancel event handler.
    $("body").on("click", "#MANAGEPROJECTION .Cancel", function () {
        var row = $(this).closest("tr");
        $("td", row).each(function () {
            if ($(this).find("input").length > 0) {
                var span = $(this).find("span");
                var input = $(this).find("input");
                //input.val(span.html());
                span.show();
                 $(this).removeClass('selected');
                input.hide();
            }
        });
        row.find(".Edit").show();
        //row.find(".Delete").show();
        row.find(".Update").hide();
        row.find("input#txtActivityDesc").show();
        $(this).hide();
       
    });
</script>


<style>

    .textarea {
        max-width: 280px;
        font-size: 10px;
        border: 2px;
        outline: 2px;
    }

    
       
    .form-group {
        margin-bottom: 2px;
        padding-right: 0;
        padding-left: 0;
        font-size: 10px;
        border-radius: 9px;
        padding-bottom: 2px;
        margin-top: 0px;
    }

    .btn-primary, .btn-primary:hover, .btn-primary:active, .btn-primary:visited {
        background-color: #FFA500;
        border-color: white;
    }


    .page-item.active .page-link {
        color: white !important;
        background-color: orange !important;
        border-color: gray !important;
    }



    /* Active State */
    .x-tab-pane > .active > a, .x-tab-pane > .active > a:hover {
        background-color: #f0f0f0;
    }

    .tab-pane {
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        border-top: 1px solid #ddd;
        border-radius: 0px 0px 5px 5px;
        padding: 10px;
    }

    .form-control {
        margin-bottom: 2px;
        padding-right: 0;
        padding-left: 0;
        font-size: 12px;
        font-family: Arial;
        border-radius: 9px;
        padding-bottom: 2px;
        margin-top: 0px;
    }

    .form-group {
        margin-bottom: 2px;
        padding-right: 0;
        padding-left: 0;
        font-size: 10px;
        border-radius: 9px;
        padding-bottom: 2px;
        margin-top: 0px;
    }


    .row-group {
        width: 47%;
        min-height: 100px;
        padding-top: 10px;
        padding-bottom: 10px;
        padding-left: 5px;
        padding-right: 5px;
        margin-bottom: 20px;
        background-color: whitesmoke;
        border: 1px solid #e3e3e3;
        border-radius: 2px;
        -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
        box-shadow: inset 0 1px 1px rgba(0,0,0,.05);
    }
        .commentsLine{
    max-width:50px;
    word-wrap:break-word;
}
input[type=text] {
  color: #000;
  background-color: #fff;
}
 .selected {
        color: black;
        background-color: lightgray;
    }
    .table-hover > tbody > tr:hover > td,
    .table-hover > tbody > tr:hover > th {
        background-color: lightgray;
    }
/*
</style>
